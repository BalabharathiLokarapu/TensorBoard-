<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="utils.html">

<!--
  tf-op-bar shows a small % utilization bar, colored using flameColor.
-->
<dom-module id="tf-op-bar">
<style>
:host {
  display: inline-block;
  height: 1.5em;
  line-height: 1.5em;
}
</style>
<template>
&nbsp;[[_percent(value)]]
</template>
<script>
import {flameColor, percent} from './utils.js';

Polymer({
  is: 'tf-op-bar',
  properties: {
    value: {
      type: Number,
      notify: true,
      observer: '_updateValue',
    },
  },
  _percent: percent,
  _updateValue: function(value) {
    this.style.background = "linear-gradient(to right, " + flameColor(value) +
        " " + percent(value) + ", #ccc " + percent(value) + ")";
  },
});
</script>
</dom-module>

<!--
  tf-op-details is a card that describes an op or group of ops (the 'item').
-->
<dom-module id="tf-op-details">
<style>
paper-card {
  --paper-card-header-color: white;
  width: 100%;
}
tf-op-bar {
  width: 100%;
}
#subheader {
  padding: 0 16px 16px;
  color: rgba(255, 255, 255, 0.7);
  position: relative;
  top: -10px;
}
.card-content > div {
  margin-bottom: 1em;
}
.expression {
  display: block;
  word-wrap: break-word;
}
</style>
<template>
  <paper-card id="card" heading="[[item.name]]" elevation="2">
    <div id="subheader">[[_subheader(item)]]</div>
    <div class="card-content">
      <div hidden="[[!item.metrics]]">
        <b>FLOPS utilization: </b>
        <tf-op-bar value="[[_utilization(item)]]"></tf-op-bar>
      </div>
      <div hidden="[[!item.xla.expression]]">
        <b>Expression: </b>
        <code class="expression">[[item.xla.expression]]</code>
      </div>
    </div>
  </paper-card>
</template>

<script>
import {flameColor, utilization} from './utils.js';

Polymer({
  is: 'tf-op-details',
  properties: {
    item: {
      type: Object,
      notify: true,
      observer: '_updateCard',
    },
  },
  _bgColor: function(item) {
    return 'red';
  },
  _utilization: utilization,
  _updateCard: function(item){
    if (item == null) return;
    var color = flameColor(utilization(item), 0.7);
    this.$.card.updateStyles({"--paper-card-header": "background-color:" + color});
    this.$.subheader.style.backgroundColor = color;
  },
  _subheader: function(item) {
    if (!item) return null;
    if (item.xla) return item.metrics ? "Operation" : "Fused operation";
    if (item.category) return "Operation category";
    return "Unknown";
  },
});
</script>
</dom-module>
