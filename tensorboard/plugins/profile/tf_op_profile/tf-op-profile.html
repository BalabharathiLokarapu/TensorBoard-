<link rel="import" href="tf-op-table.html">

<dom-module id="tf-op-profile">
<template>
<style>
</style>
<div class="tf-op-profile">
  <tf-op-table root-node="[[_root]]" active={{_active}}></tf-op-table>
</div>
</dom-module>

<script>
import {RequestManager} from '../tf-backend/requestManager.js';
import {getRouter} from '../tf-backend/router.js';

Polymer({
  is: 'tf-op-profile',
  properties: {
    _requestManager: {
      type: Object,
      value: () => new RequestManager(),
    },
    _data: {
      type: Object,
      notify: true,
    },
    _breakdown: {
      type: String,
      value: 'byCategory',
      notify: true,
    },
    _root: {
      type: Object,
      computed: '_getRoot(_data, _breakdown)',
      notify: true,
    },
    _active: {
      type: Object,
      value: null,
      notify: true,
      observer: '_activeChanged'
    },
    run: {
      type: String,
      notify: true,
      observer: '_runChanged'
    },
  },
  _runChanged: function(run) {
    this._requestManager.request(
        getRouter().
            pluginRunTagRoute('profile', '/data')('op_profile', run)
    ).then((data) => {
      console.log("Loaded profile ", data);
      this._data = data;
    });
  },
  _getRoot: function(data, breakdown) {
    return data[breakdown];
  },
  _activeChanged: function(active) {
    console.log('active changed:', active);
  },
});
</script>
